<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Dashboard {{ version }}</h1>
    <nav class="dashboard-nav">
      <button (click)="toggleUsers()" class="nav-link">{{ showUsers ? 'Hide Users' : 'View Users' }}</button>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </nav>
  </header>
  
  <main class="dashboard-content">
    <div class="welcome-card">
      <h2>Welcome to Your Dashboard!</h2>
      <p>You have successfully logged in.</p>
      <p class="version-info">Current Version: {{ version }}</p>
      <p class="last-updated">Last Updated: {{ lastUpdated }}</p>
    </div>
    
    <div class="stats-grid" *ngIf="!loading; else loadingTemplate">
      <div class="stat-card">
        <h3>Total Users</h3>
        <p class="stat-number">{{ dashboardData.totalUsers | number }}</p>
      </div>
      <div class="stat-card">
        <h3>Active Sessions</h3>
        <p class="stat-number">{{ dashboardData.activeSessions }}</p>
      </div>
      <div class="stat-card">
        <h3>System Status</h3>
        <p class="stat-status">{{ dashboardData.systemStatus }}</p>
      </div>
    </div>

    <!-- User Table - Only shown when View Users is clicked -->
    <div *ngIf="showUsers" class="user-section">
      <h3>Registered Users</h3>
      
      <div *ngIf="users.length > 0" class="user-table-container">
        <table class="user-table">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Created At</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of users">
              <td>{{ user.userId || user.id }}</td>
              <td>{{ user.name || user.username }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.createdAt || user.created_at | date }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Show error message if there's an error -->
      <div *ngIf="error && users.length === 0" class="error-message">
        <p>{{ error }}</p>
      </div>
      
      <!-- Show 'No users found' only if no error and no users -->
      <div *ngIf="users.length === 0 && !error && !loading" class="info-message">
        <p>No users registered yet.</p>
      </div>
    </div>

    <!-- Database Information Section -->
    <div class="database-section">
      <h3>PostgreSQL Database Information</h3>
      
      <div *ngIf="databaseLoading" class="loading-message">
        <p>Loading database information...</p>
      </div>
      
      <div *ngIf="databaseError" class="error-message">
        <p>{{ databaseError }}</p>
      </div>
      
      <div *ngIf="databaseInfo && !databaseLoading" class="database-info">
        <div class="db-stats-grid">
          <div class="db-stat-card">
            <h4>Database</h4>
            <p>{{ databaseInfo.database?.name }}</p>
          </div>
          <div class="db-stat-card">
            <h4>Host</h4>
            <p>{{ databaseInfo.database?.host }}</p>
          </div>
          <div class="db-stat-card">
            <h4>Total Tables</h4>
            <p>{{ databaseInfo.statistics?.totalTables }}</p>
          </div>
          <div class="db-stat-card">
            <h4>Total Records</h4>
            <p>{{ databaseInfo.statistics?.totalRows }}</p>
          </div>
        </div>
        
        <div class="tables-info" *ngIf="databaseInfo.tables?.length > 0">
          <h4>Database Tables:</h4>
          <div class="tables-grid">
            <div *ngFor="let tableName of databaseInfo.tables" class="table-card">
              <h5>{{ tableName }}</h5>
              <div *ngIf="databaseInfo.tableData[tableName]">
                <p *ngIf="!databaseInfo.tableData[tableName].error">
                  Rows: {{ databaseInfo.tableData[tableName].totalRows }}
                </p>
                <p *ngIf="databaseInfo.tableData[tableName].error" class="error-text">
                  {{ databaseInfo.tableData[tableName].error }}
                </p>
                
                <!-- Sample Data -->
                <div *ngIf="databaseInfo.tableData[tableName].sampleData?.length > 0" class="sample-data">
                  <h6>Sample Data:</h6>
                  <table class="sample-table">
                    <thead>
                      <tr>
                        <th *ngFor="let col of databaseInfo.tableData[tableName].columnNames">{{ col }}</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let row of databaseInfo.tableData[tableName].sampleData">
                        <td *ngFor="let col of databaseInfo.tableData[tableName].columnNames">{{ row[col] }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <ng-template #loadingTemplate>
      <div class="loading-message">
        <p>Loading dashboard data...</p>
      </div>
    </ng-template>
  </main>
</div>